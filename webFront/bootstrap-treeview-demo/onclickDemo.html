<!DOCTYPE html>
<html>
	<!--
    	作者：jinzhanye@foxmail.com
    	时间：2017-02-08
    	描述：
    	http://www.augsky.com/992.html
    	https://my.oschina.net/OriginLeon/blog/652492
    -->

	<head>
		<link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet">
		<link href="//cdn.bootcss.com/bootstrap-treeview/1.2.0/bootstrap-treeview.min.css" rel="stylesheet">
		<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
		<link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<script src="//cdn.bootcss.com/bootstrap-treeview/1.2.0/bootstrap-treeview.min.js"></script>
		<meta charset="utf-8" />
		<title></title>
		<script type="text/javascript">
			var defaultData = [{
				text: 'Parent 1',
				href: '#parent1',
				tags: ['4'],
				nodes: [{
					text: 'Child 1',
					href: '#child1',
					tags: ['2'],
					nodes: [{
						text: 'Grandchild 1',
						href: '#grandchild1',
						tags: ['0']
					}, {
						text: 'Grandchild 2',
						href: '#grandchild2',
						tags: ['0']
					}]
				}, {
					text: 'Child 2',
					href: '#child2',
					tags: ['0']
				}]
			}, {
				text: 'Parent 2',
				href: '#parent2',
				tags: ['0'],
				nodes: [{
					text: 'Child 1',
					href: '#child1',
					tags: ['2'],
					nodes: [{
						text: 'Grandchild 1',
						href: '#grandchild1',
						tags: ['0']
					}, {
						text: 'Grandchild 2',
						href: '#grandchild2',
						tags: ['0']
					}]
				}, {
					text: 'Child 2',
					href: '#child2',
					tags: ['0']
				}]
			}, {
				text: 'Parent 3',
				href: '#parent3',
			}, {
				text: 'Parent 4',
				href: '#parent4',
				tags: ['0']
			}, {
				text: 'Parent 5',
				href: '#parent5',
				tags: ['0']
			}];
			//递归获取所有的结点id
			function getNodeIdArr(node) {
				var ts = [];
				if(node.nodes) {
					for(x in node.nodes) {
						ts.push(node.nodes[x].nodeId)
						if(node.nodes[x].nodes) {
							var getNodeDieDai = getNodeIdArr(node.nodes[x]);
							for(j in getNodeDieDai) {
								ts.push(getNodeDieDai[j]);
							}
						}
					}
				}
				return ts;
			}
		</script>
	</head>

	<body>
		<div id="treeview-checkable"></div>
		<button type="button" class="btn btn-primary" onclick="chose()">OK</button>
	</body>

	<script type="text/javascript">
		function setParentChecked(node) {
			debugger;
			var parentNodeId = node.parentId;
			if(typeof(parentNodeId) == "undefined")
				return;

			var parentNode = $('#treeview-checkable').treeview('getParent', node);
			$('#treeview-checkable').treeview('checkNode', [parentNode, {
				silent: true
			}]);
			setParentChecked(parentNode);
		}

		function setParentUnchecked(node) {
			var parentNode = $('#treeview-checkable').treeview('getParent', node);
			if(typeof(parentNode) == "undefined")
				return;
			var siblings = $('#treeview-checkable').treeview('getSiblings', node);
			var allUnchecked = true;
			for(var i = 0; i < siblings.length; i++) {
				if(siblings[i].state.checked == true) {
					allUnchecked = false;
					break;
				}
			}

			if(allUnchecked == false) {
				return;
			}

			$('#treeview-checkable').treeview('uncheckNode', [parentNode, {
				silent: true
			}]);
			setParentUnchecked(parentNode);
		}
		$(function() {
			//结点接口实现
			var $checkableTree = $('#treeview-checkable').treeview({
				data: defaultData, //数据
				showIcon: false,
				showCheckbox: true,
				levels: 4,
				onNodeChecked: function(event, node) { //选中节点
					var selectNodes = getNodeIdArr(node); //获取所有子节点
					debugger;
					if(selectNodes) { //子节点不为空，则选中所有子节点
						$('#treeview-checkable').treeview('checkNode', [selectNodes, {
							silent: true
						}]);
					}
					//设置所有父节点为选中状态
					setParentChecked(node);
				},
				onNodeUnchecked: function(event, node) { //取消选中节点
					var selectNodes = getNodeIdArr(node); //获取所有子节点
					if(selectNodes) { //子节点不为空，则取消选中所有子节点
						$('#treeview-checkable').treeview('uncheckNode', [selectNodes, {
							silent: true
						}]);
					}
					//设置所有父节点为选中状态
					setParentUnchecked(node);
				}
			});

			$('#treeview-checkable').on('click', 'li', function(event) {			
				debugger;
				var currentNode;
				if($(event.target).children(".glyphicon").hasClass("glyphicon-plus") || $(event.target).children(".glyphicon").hasClass("glyphicon-minus")) {
					$(event.target).children(".glyphicon")[0].click();
				}
			});
		});
	</script>

</html>